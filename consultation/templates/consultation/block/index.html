{% extends 'admin_site/layout.html' %}
{% block 'main' %}
{% load static %}

<div class="col-12">
    <div class="card recent-sales overflow-auto">
        <div class="filter px-2">
            <a title="Add Consultation Block" class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
            <button class="btn btn-sm btn-info text-white" data-bs-toggle="modal" data-bs-target="#blockHelperModal"><b>Helper</b></button>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                <li class="dropdown-header text-start">
                    <h6>Action</h6>
                </li>
                <li><a class="dropdown-item" href="#">
                    <button title="Add Consultation Block" type="button" style="width:100%" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#verticalycentered">Add Consultation Block</button>
                </a></li>
            </ul>
        </div>


        <div class="card-body">
            <h5 class="card-title">List of Consultation Blocks</h5>
            {% include 'admin_site/partials/error.html' %}
            <table class="table table-borderless datatable">
                <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Block Name</th>
                    <th scope="col">Description</th>
                    <th scope="col" class="text-center">Action</th>
                </tr>
                </thead>
                <tbody>

                {% for block in block_list %}
                <tr>
                    <th scope="row"><a href="#">{{ forloop.counter }}</a></th>
                    <td title="created at {{ block.created_at|date }}">{{ block.name|title }}</td>
                    <td>{% if block.description %}{{ block.description }}{% endif %}</td>
                    <td class="text-center">
                        <button title="Edit Consultation Block" type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#edit{{ forloop.counter }}"><i class="bi bi-pencil-square"></i></button>
                        <a title="Delete Consultation Block" href="{% url 'block_delete' block.id %}" class="btn btn-danger"><i class="bi bi-trash"></i></a>
                    </td>
                </tr>
                {% endfor %}


                </tbody>
            </table>
            {% if not block_list %}
                 <h3 class="text-center">No Consultation Block Added Yet</h3>

            {% endif %}

        </div>
    </div>
</div>

<div class="modal fade" id="blockHelperModal" tabindex="-1" style="font-family: sans-serif">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><b>Consultation Block Helper</b></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="card-description">
                    Consultation blocks (or wings) are used to organize the physical layout of the hospital or clinic. They help in grouping consultation rooms and can be used to guide patients and staff to specific areas.
                </p>

                <div class="alert alert-warning">
                    <strong>Note:</strong> Block descriptions are optional, but they help clarify the block's purpose or location.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Got it</button>
            </div>
        </div>
    </div>
</div>


<form method="POST" action="{% url 'block_create' %}">
    {% csrf_token %}
    <div class="modal fade" id="verticalycentered" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><b>Add Consultation Block</b></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-floating">
                        {{ form.name }}
                        <label for="floatingName">Block Name<span style="color:red"><b>*</b></span></label>
                    </div><br />

                    <div class="form-floating">
                        {{ form.description }}
                        <label for="floatingName">Description </label>
                    </div><br />

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>
</form>

{% for block in block_list %}
<form method="POST" action="{% url 'block_edit' block.id %}">
    {% csrf_token %}
    <div class="modal fade" id="edit{{ forloop.counter }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><b>Edit Consultation Block</b></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-floating">
                        <input type="text" name="name" value="{{ block.name|lower }}" autocomplete="off" required class="form-control">
                        <label for="floatingName">Block Name<span style="color:red"><b>*</b></span></label>
                    </div><br />

                    <div class="form-floating">
                        <textarea name="description" class="form-control">{% if block.description %}{{ block.description|lower }}{% endif %}</textarea>
                        <label for="floatingName">Description </label>
                    </div><br />

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
</form>
{% endfor %}


{% endblock %}