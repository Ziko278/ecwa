{% extends 'admin_site/layout.html' %}
{% load static %}
{% load humanize %}
{% block 'main' %}

<div class="row">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="heading card-title mb-0"><b>Pending Patient Registration</b></h4>
        <input type="text" id="searchInput" class="form-control w-auto" placeholder="Search...">
    </div>

    <div class="col-xl-12 active-p">
        <div class="card">
            <div class="card-body px-0">
                <div class="table-responsive active-projects dt-filter">
                    <table id="pendingTable" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Full Name</th>
                                <th>Reference</th>
                                <th>Patient Type</th>
                                <th>Card Number</th>
                                <th>Consultant</th>
                                <th>Payment Date</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in pending_payment_list %}
                            <tr>
                                <td>{{ payment.full_name|title }}</td>
                                <td>{{ payment.transaction_id|upper }}</td>
                                <td class="text-center" style="color: {% if payment.registration_fee.patient_type == 'new' %}green{% else %}red{% endif %};">
									{{ payment.registration_fee.patient_type|upper }}
								</td>

                                <td>{{ payment.old_card_number|upper }}</td>
                                <td>{{ payment.consultation_fee.specialization|title }}</td>
                                <td>{{ payment.created_at|date:"M d, Y H:i" }}</td>
                                <td>
                                    <a href="{% url 'patient_create' payment.id %}" class="btn btn-primary btn-sm">Register</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Pagination if needed -->
                {% if is_paginated %}
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-end">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        {% endif %}
                        {% for num in paginator.page_range %}
                            {% if page_obj.number == num %}
                                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                            {% else %}
                                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                            {% endif %}
                        {% endfor %}
                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}

            </div>
        </div>
    </div>
</div>

<!-- JS for frontend search -->
<script>
const searchInput = document.getElementById('searchInput');
const table = document.getElementById('pendingTable').getElementsByTagName('tbody')[0];

searchInput.addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    const rows = table.getElementsByTagName('tr');
    Array.from(rows).forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
});
</script>

{% endblock %}
