{% extends 'admin_site/layout.html' %}
{% load static humanize %}
{% block 'main' %}
<style>
.report-container {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 24px;
    margin-bottom: 20px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}
.report-header {
    border-bottom: 2px solid #4472C4;
    padding-bottom: 16px;
    margin-bottom: 24px;
    text-align: center;
}
.filters-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 6px;
    margin-bottom: 24px;
}
.form-group {
    margin-bottom: 16px;
}
.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
    color: #333;
}
.form-control {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
}
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
}
.btn-primary {
    background: #4472C4;
    color: white;
}
.btn-success {
    background: #28a745;
    color: white;
}
.btn-info {
    background: #17a2b8;
    color: white;
}
.controls-bar {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-bottom: 20px;
}
.financial-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 24px;
}
.financial-table td {
    padding: 14px 16px;
    border-bottom: 1px solid #e0e0e0;
}
.financial-table tr:nth-child(even) {
    background: #f8f9fa;
}
.financial-table td:first-child {
    font-weight: 500;
    color: #333;
    width: 60%;
}
.financial-table td:last-child {
    text-align: right;
    font-weight: 600;
    color: #4472C4;
    width: 40%;
}
.financial-table tr.total {
    background: linear-gradient(135deg, #4472C4 0%, #365a99 100%);
    color: white;
}
.financial-table tr.total td {
    border-top: 3px solid #2c5a9e;
    border-bottom: 3px solid #2c5a9e;
    font-size: 1.2em;
    padding: 18px 16px;
}
.financial-table tr.total td:last-child {
    color: white;
}
.summary-box {
    background: linear-gradient(135deg, #28a745 0%, #218838 100%);
    color: white;
    padding: 24px;
    border-radius: 8px;
    text-align: center;
    margin-top: 24px;
}
.summary-box h3 {
    margin: 0 0 8px 0;
    font-size: 16px;
    font-weight: 500;
    opacity: 0.9;
}
.summary-box .value {
    font-size: 40px;
    font-weight: 700;
}
</style>

<div class="report-container">
    <div class="report-header">
        <h2>{{ report_title }}</h2>
        <p style="color: #666; margin: 8px 0 0 0;">
            {{ from_date|date:"F d, Y" }} to {{ to_date|date:"F d, Y" }}
        </p>
    </div>

    <div class="filters-section">
        <form method="get" id="reportForm">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <div class="form-group">
                    <label for="from_date">From Date</label>
                    <input type="date" name="from_date" id="from_date" class="form-control" value="{{ from_date|date:'Y-m-d' }}">
                </div>
                <div class="form-group">
                    <label for="to_date">To Date</label>
                    <input type="date" name="to_date" id="to_date" class="form-control" value="{{ to_date|date:'Y-m-d' }}">
                </div>
                <div class="form-group">
                    <label for="title">Report Title</label>
                    <input type="text" name="title" id="title" class="form-control" value="{{ report_title }}">
                </div>
            </div>
            <div style="margin-top: 16px;">
                <button type="submit" class="btn btn-primary">Generate Report</button>
            </div>
        </form>
    </div>

    <div class="controls-bar">
        <button class="btn btn-success" onclick="exportToExcel()">
            <i class="fas fa-file-excel"></i> Export Excel
        </button>
        <button class="btn btn-info" onclick="exportToPDF()">
            <i class="fas fa-file-pdf"></i> Export PDF
        </button>
    </div>

    <table class="financial-table">
        {% for item in financial_data %}
        <tr>
            <td>{{ item.category }}</td>
            <td>₦{{ item.amount|floatformat:2|intcomma }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="2" style="text-align: center; padding: 40px; color: #999;">
                No financial data available for the selected period.
            </td>
        </tr>
        {% endfor %}

        {% if financial_data %}
        <tr class="total">
            <td><strong>GRAND TOTAL</strong></td>
            <td><strong>₦{{ grand_total|floatformat:2|intcomma }}</strong></td>
        </tr>
        {% endif %}
    </table>

    {% if grand_total %}
    <div class="summary-box">
        <h3>Total Revenue</h3>
        <p class="value">₦{{ grand_total|floatformat:2|intcomma }}</p>
    </div>
    {% endif %}
</div>

<script>
function getParams() {
    const fromDate = document.getElementById('from_date').value;
    const toDate = document.getElementById('to_date').value;
    const title = document.getElementById('title').value;
    
    return new URLSearchParams({
        from_date: fromDate,
        to_date: toDate,
        title: title
    });
}

function exportToExcel() {
    const params = getParams();
    window.location.href = `{% url 'general_financial_export_excel' %}?${params.toString()}`;
}

function exportToPDF() {
    const params = getParams();
    window.location.href = `{% url 'general_financial_export_pdf' %}?${params.toString()}`;
}
</script>
{% endblock %}